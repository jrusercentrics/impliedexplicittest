<script type="text/javascript">
  window.addEventListener('CookiebotOnDialogDisplay', function () {
    const euRegex = /AT|BE|BG|CY|CZ|DE|DK|EE|ES|FI|FR|GB|GR|HR|HU|IE|IT|LT|LU|LV|MT|NL|PL|PT|RO|SE|SI|SK/;
    const country = (Cookiebot.userCountry || "").toUpperCase();

    if (euRegex.test(country)) {
      // EU → explicit consent only
      Cookiebot.dialog.consentLevel = 'strict';
      Cookiebot.dialog.detachOnscrollEvent();
      console.log("EU detected → Explicit consent required");
    } else {
      // Non-EU → implicit consent allowed
      Cookiebot.dialog.consentLevel = 'implied';
      Cookiebot.dialog.setOnscrollEvent();
      console.log("Non-EU detected → Implicit consent active");

      // Helper to apply full consent + close banner
      function fullConsent(reason) {
        console.log(`User ${reason} → forcing full consent & closing banner`);
        Cookiebot.submitCustomConsent(true, true, true, true);
        if (Cookiebot.dialog.isVisible) {
          Cookiebot.dialog.submitConsent();
        }
      }

      // On first scroll or click, force consent AND close banner
      window.addEventListener("scroll", () => fullConsent("scrolled"), { once: true });
      window.addEventListener("click", () => fullConsent("clicked"), { once: true });
    }
  });

  // Debug log when consent is updated
  window.addEventListener("CookieConsentDeclaration", function () {
    console.log("Consent updated:", Cookiebot.consent);
  });
</script>
