<script type="text/javascript">
  function updateDebug() {
    if (window.Cookiebot) {
      document.getElementById("country").textContent = Cookiebot.userCountry || "N/A";
      document.getElementById("status").textContent = Cookiebot.consent?.method || "N/A";
      document.getElementById("consent").textContent = JSON.stringify(Cookiebot.consent, null, 2);
      console.log("DEBUG - Country:", Cookiebot.userCountry);
      console.log("DEBUG - Consent:", Cookiebot.consent);
    }
  }

  function forceFullConsent(reason) {
    console.log(`User ${reason} → forcing full consent & closing banner`);
    Cookiebot.submitCustomConsent(true, true, true, true); // aceitar tudo
    if (Cookiebot.dialog && Cookiebot.dialog.isVisible) {
      Cookiebot.dialog.submitConsent(); // fechar o banner
    }
    updateDebug();
  }

  window.addEventListener("CookiebotOnDialogDisplay", function () {
    const euRegex = /AT|BE|BG|CY|CZ|DE|DK|EE|ES|FI|FR|GB|GR|HR|HU|IE|IT|LT|LU|LV|MT|NL|PL|PT|RO|SE|SI|SK/;
    const excluded = /BR|CA/;
    const country = (Cookiebot.userCountry || "").toUpperCase();

    document.getElementById("country").textContent = country;

    if (euRegex.test(country)) {
      console.log("EU detected → explicit consent required");
      Cookiebot.dialog.consentLevel = "strict";
    } else if (!excluded.test(country)) {
      console.log("Non-EU detected → implicit consent via scroll/click");

      // scroll ou click → aceita tudo + fecha banner
      window.addEventListener("scroll", () => forceFullConsent("scrolled"), { once: true });
      window.addEventListener("click", () => forceFullConsent("clicked"), { once: true });
    } else {
      console.log("Excluded country → no override applied");
    }
  });

  window.addEventListener("CookieConsentDeclaration", updateDebug);
</script>
